<div class="main-container">
    <h2 class="welcome-title">üéß Bienvenido, {{ username }}</h2>

    <form class="search-form" (submit)="buscarCanciones(); $event.preventDefault()">
        <input type="text" class="input search-input" placeholder="üîç Buscar por nombre o autor..."
            [(ngModel)]="terminoBusqueda" name="busqueda" />
        <div class="search-buttons">
            <button type="submit" class="submit-btn">Buscar</button>
            <button type="button" class="clear-btn" (click)="limpiarBusqueda()">Limpiar</button>
        </div>
    </form>




    <form class="song-form" (submit)="addCancion(); $event.preventDefault()">
        <input type="text" class="input" placeholder="Nombre de la canci√≥n..." [(ngModel)]="cancionNombre"
            name="nombre" />
        <input type="text" class="input" placeholder="Autor de la canci√≥n..." [(ngModel)]="cancionAutor" name="autor" />
        <input type="text" class="input" placeholder="Enlace de la canci√≥n..." [(ngModel)]="cancionLink" name="link" />
        <button type="submit" class="submit-btn">Agregar canci√≥n</button>
    </form>



    <ng-container *ngIf="modoBusquedaActiva || (!modoBusquedaActiva && canciones.length)">
        <div class="cancion-card" *ngFor="let cancion of canciones">
            <div class="cancion-info">
                <h3>{{ cancion.nombre }} - {{ cancion.autor }}</h3>
                <p>Publicado por: {{ cancion.postedBy?.username || 'Desconocido' }}</p>

                <div *ngIf="esLinkDeYoutube(cancion.link)">
                    <a [href]="cancion.link" target="_blank">
                        <img [src]="getThumbnail(cancion.link)" alt="Miniatura de YouTube" width="200"
                            class="youtube-thumbnail" />
                    </a>
                    <br />
                    <a [href]="cancion.link" target="_blank" class="song-link">üéµ Escuchar</a>
                </div>

                <!-- Si no es de YouTube, muestra solo el link como texto o ign√≥ralo -->
                <div *ngIf="!esLinkDeYoutube(cancion.link)">
                    <a [href]="cancion.link" target="_blank" class="song-link">üéµ Escuchar</a>
                </div>


                <p *ngIf="cancion.reaccionMasVotada">
                    ‚≠ê Reacci√≥n m√°s votada:
                    <strong>
                        <ng-container
                            *ngFor="let star of [].constructor(getNumeroEstrellas(cancion.reaccionMasVotada))">
                            ‚≠ê
                        </ng-container>
                    </strong>
                </p><button (click)="borrarCancion(cancion.id)" class="clear-btn">
                    üóë Borrar
                </button>


            </div>

            <div class="reactions">
                <button *ngFor="let star of [1,2,3,4,5]" (click)="reaccionar(cancion.id, star)">
                    ‚≠ê {{ star }}
                </button>
            </div>

            <div class="comentarios" *ngIf="cancion.comentarios?.length">
                <div *ngFor="let comentario of cancion.comentarios">
                    <strong>{{ comentario.nombreUsuario }}:</strong> {{ comentario.contenido }}
                </div>
            </div>

            <form class="comentario-form" (submit)="crearComentario(cancion); $event.preventDefault()">
                <input type="text" [(ngModel)]="cancion.nuevoComentario" [name]="'comentario' + cancion.id"
                    placeholder="Escribe un comentario..." />
                <button type="submit">Comentar</button>
            </form>
        </div>
    </ng-container>
    <div class="paginacion">
        <button (click)="paginaActual = paginaActual - 1; getCanciones()"
            [disabled]="paginaActual === 0">Anterior</button>
        <span>P√°gina {{ paginaActual + 1 }} de {{ totalPaginas }}</span>
        <button (click)="paginaActual = paginaActual + 1; getCanciones()"
            [disabled]="paginaActual + 1 >= totalPaginas">Siguiente</button>
    </div>
</div>